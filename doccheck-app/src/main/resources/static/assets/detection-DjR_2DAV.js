var ie=Object.defineProperty,ce=Object.defineProperties;var pe=Object.getOwnPropertyDescriptors;var M=Object.getOwnPropertySymbols;var me=Object.prototype.hasOwnProperty,ve=Object.prototype.propertyIsEnumerable;var P=(i,r,d)=>r in i?ie(i,r,{enumerable:!0,configurable:!0,writable:!0,value:d}):i[r]=d,G=(i,r)=>{for(var d in r||(r={}))me.call(r,d)&&P(i,d,r[d]);if(M)for(var d of M(r))ve.call(r,d)&&P(i,d,r[d]);return i},j=(i,r)=>ce(i,pe(r));var _=(i,r,d)=>new Promise((E,I)=>{var N=y=>{try{c(d.next(y))}catch(s){I(s)}},w=y=>{try{c(d.throw(y))}catch(s){I(s)}},c=y=>y.done?E(y.value):Promise.resolve(y.value).then(N,w);c((d=d.apply(i,r)).next())});import{e as ye,f as fe,g as _e,h as ge,a as Re,i as be}from"./knowledge-Bxgu3x4V.js";import{_ as he}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{o as Ne,s as xe,r as p,e as J,g as L,f as a,w as l,c as n,d as x,h as m,t as K,F as Ie,G as ke,m as U,D as z,E as h,v as Ce}from"./index-B4_lMgQc.js";const Ve={class:"main_page"},Ee={class:"table-header-container"},we={style:{margin:"20px",height:"20px"}},De={class:"dialog-footer"},Se={__name:"detection",setup(i){Ne(()=>{d(),window.addEventListener("resize",d),g()}),xe(()=>{window.removeEventListener("resize",d)});const r=p(0),d=()=>{const t=window.innerHeight,o=document.querySelector(".table-header-container"),C=o?o.offsetHeight:200,T=50;r.value=t-C-T-250,console.log(r.value,"99999")},E=p([]),I=()=>_(this,null,function*(){const t=yield Re();t.data.code===200&&(E.value=t.data.data)}),N=p([]),w=t=>_(this,null,function*(){const o=yield be(t);o.data.code===200&&(N.value=o.data.data,e.value.docRepositoryIds=[])}),c=p({duplicateRepositoryName:"",dataResource:""}),y=()=>{c.value={duplicateRepositoryName:"",dataResource:""}},s=p({pageNo:1,pageSize:10,duplicateRepositoryName:"",dataResource:""}),q=p([]),B=p(0),g=()=>_(this,null,function*(){const t=yield ye(j(G({},s.value),{repositoryDuplicateName:s.value.extractRuleName,dataSource:s.value.docRepositoryName}));t.data.code===200&&(q.value=t.data.data.result,B.value=t.data.data.total)}),O=()=>{s.value.duplicateRepositoryName=c.value.duplicateRepositoryName,s.value.dataResource=c.value.dataResource,g(),s.value.pageNo=1},Q=t=>{s.value.pageNo=t,g()},W=t=>{s.value.pageSize=t,g()},R=p(!1),D=p("新建查重库"),e=p({duplicateRepositoryName:"",dataResource:"0",ruleExtractIds:null,docRepositoryIds:[],apiUrl:"",apiToken:""}),X=t=>{e.value.docRepositoryIds=t.map(o=>o.id)},Y=p(null),Z=()=>{R.value=!0,D.value="新建查重库",e.value={duplicateRepositoryName:"",dataResource:"0",ruleExtractIds:null,docRepositoryIds:[],apiUrl:"",apiToken:""},N.value=[],I()},ee=t=>{t?w(t):(N.value=[],e.value.docRepositoryIds=[])},H=()=>{R.value=!1,e.value={duplicateRepositoryName:"",dataResource:""}},k=p(!1),ae=()=>_(this,null,function*(){if(k.value=!0,console.log(e.value.ruleExtractIds),e.value.dataResource==0&&!e.value.ruleExtractIds)return h({showClose:!0,message:"关联提取规则为必填项",type:"error"});const t=yield fe(e.value.dataResource==0?{repositoryDuplicateName:e.value.duplicateRepositoryName,dataSource:e.value.dataResource,ruleExtractId:e.value.ruleExtractIds,repositoryDocIds:e.value.docRepositoryIds}:{repositoryDuplicateName:e.value.duplicateRepositoryName,dataSource:e.value.dataResource,ruleExtractId:e.value.ruleExtractIds,apiUrl:e.value.apiUrl,apiToken:e.value.apiToken});k.value=!1,t.data.code===200?(h({showClose:!0,message:"新建成功",type:"success"}),R.value=!1,g()):h({showClose:!0,message:t.data.data,type:"error"})}),te=t=>{Ce.alert("确认删除吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>_(this,null,function*(){le(t.id)})).catch(()=>{console.log("取消删除")})},le=t=>_(this,null,function*(){const o=yield _e(t);o.data.code===200?(h.success("删除成功"),g()):h({showClose:!0,message:o.data.data,type:"error"})}),oe=t=>{D.value="编辑查重库",e.value={id:t.id,duplicateRepositoryName:t.repositoryDuplicateName,dataResource:t.dataSource.toString(),ruleExtractIds:t.ruleExtractId,docRepositoryIds:t.dataSource==0?t.repositoryDocs.map(o=>o.id):[],apiUrl:t.apiUrl,apiToken:t.apiToken},console.log(e.value.docRepositoryIds),I(),w(t.ruleExtractId),R.value=!0},ue=()=>_(this,null,function*(){k.value=!0;const t=yield ge(e.value.dataResource==0?{id:e.value.id,repositoryDuplicateName:e.value.duplicateRepositoryName,dataSource:e.value.dataResource,ruleExtractId:e.value.ruleExtractIds,repositoryDocIds:e.value.docRepositoryIds}:{id:e.value.id,repositoryDuplicateName:e.value.duplicateRepositoryName,dataSource:e.value.dataResource,apiUrl:e.value.apiUrl,apiToken:e.value.apiToken,ruleExtractId:e.value.ruleExtractIds});k.value=!1,t.data.code===200?(h({showClose:!0,message:"更新成功",type:"success"}),R.value=!1,g()):h({showClose:!0,message:t.data.data,type:"error"})});return(t,o)=>{const C=n("el-breadcrumb-item"),T=n("el-breadcrumb"),S=n("el-input"),v=n("el-form-item"),V=n("el-option"),A=n("el-select"),b=n("el-button"),F=n("el-form"),f=n("el-table-column"),$=n("el-table"),de=n("el-pagination"),re=n("el-card"),se=n("el-dialog");return x(),J("div",Ve,[L("div",Ee,[a(T,{separator:"/"},{default:l(()=>[a(C,{to:{path:"/"}},{default:l(()=>[m("首页")]),_:1}),a(C,null,{default:l(()=>[m("文档管理")]),_:1}),a(C,null,{default:l(()=>[m("查重库管理")]),_:1})]),_:1})]),a(re,{class:"search-card"},{default:l(()=>[a(F,{inline:!0,model:c.value,class:"demo-form-inline"},{default:l(()=>[a(v,{label:"查重库名称："},{default:l(()=>[a(S,{modelValue:c.value.duplicateRepositoryName,"onUpdate:modelValue":o[0]||(o[0]=u=>c.value.duplicateRepositoryName=u),placeholder:"请输入查重库名称",clearable:""},null,8,["modelValue"])]),_:1}),a(v,{label:"数据来源："},{default:l(()=>[a(A,{modelValue:c.value.dataResource,"onUpdate:modelValue":o[1]||(o[1]=u=>c.value.dataResource=u),placeholder:"请选择数据来源"},{default:l(()=>[a(V,{label:"内部文档库",value:"0"}),a(V,{label:"外部知识库",value:"1"})]),_:1},8,["modelValue"])]),_:1}),a(v,{class:"buttonList"},{default:l(()=>[a(b,{onClick:y},{default:l(()=>[m("重置")]),_:1}),a(b,{type:"primary",onClick:O},{default:l(()=>[m("查询")]),_:1})]),_:1}),a(v,{style:{"margin-left":"auto"}},{default:l(()=>[a(b,{type:"primary",onClick:Z},{default:l(()=>[m("新建查重库")]),_:1})]),_:1})]),_:1},8,["model"]),a($,{data:q.value,style:{width:"100%"},height:r.value},{default:l(()=>[a(f,{label:"序号",width:"90"},{default:l(u=>[m(K(u.$index+1),1)]),_:1}),a(f,{prop:"repositoryDuplicateName",label:"查重库名称"}),a(f,{prop:"dataSource",label:"数据来源"},{default:l(u=>[m(K(u.row.dataSource===0?"内部文档库":"外部知识库"),1)]),_:1}),a(f,{prop:"ruleExtractName",label:"提取规则名称"}),a(f,{prop:"updatedAt",label:"操作时间",formatter:u=>t.$filters.formatTime(u.updatedAt)},null,8,["formatter"]),a(f,{label:"操作",fixed:"right",width:"180"},{default:l(u=>[a(b,{type:"primary",onClick:ne=>oe(u.row)},{default:l(()=>[m("编辑")]),_:2},1032,["onClick"]),a(b,{type:"danger",onClick:ne=>te(u.row)},{default:l(()=>[m("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","height"]),L("div",we,[a(de,{style:{float:"right"},background:"",layout:"prev, pager, next",total:B.value,"current-page":s.value.pageNo,"page-size":s.value.pageSize,onCurrentChange:Q,onSizeChange:W},null,8,["total","current-page","page-size"])])]),_:1}),a(se,{modelValue:R.value,"onUpdate:modelValue":o[8]||(o[8]=u=>R.value=u),title:D.value,width:600,"before-close":H},{footer:l(()=>[L("div",De,[a(b,{onClick:H},{default:l(()=>[m("取消")]),_:1}),a(b,{type:"primary",loading:k.value,onClick:o[7]||(o[7]=u=>D.value=="新建查重库"?ae():ue())},{default:l(()=>[m("确定")]),_:1},8,["loading"])])]),default:l(()=>[a(F,{model:e.value,ref_key:"dialogForm",ref:Y,"label-width":"auto",style:{margin:"20px auto"}},{default:l(()=>[a(v,{label:"查重库名称: "},{default:l(()=>[a(S,{modelValue:e.value.duplicateRepositoryName,"onUpdate:modelValue":o[2]||(o[2]=u=>e.value.duplicateRepositoryName=u)},null,8,["modelValue"])]),_:1}),a(v,{label:"数据来源: "},{default:l(()=>[a(A,{modelValue:e.value.dataResource,"onUpdate:modelValue":o[3]||(o[3]=u=>e.value.dataResource=u),placeholder:"请选择数据来源"},{default:l(()=>[a(V,{label:"内部文档库",value:"0"}),a(V,{label:"外部知识库",value:"1"})]),_:1},8,["modelValue"])]),_:1}),a(v,{label:"关联提取规则: ",rules:[{required:!0}]},{default:l(()=>[a(A,{modelValue:e.value.ruleExtractIds,"onUpdate:modelValue":o[4]||(o[4]=u=>e.value.ruleExtractIds=u),placeholder:"请选择关联提取规则",onChange:ee},{default:l(()=>[(x(!0),J(Ie,null,ke(E.value,u=>(x(),U(V,{key:u.id,label:u.ruleName,value:u.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e.value.dataResource==0?(x(),U(v,{key:0,label:"选择文档: "},{default:l(()=>[a($,{data:N.value,style:{width:"100%"},border:"","header-cell-style":{"border-bottom":"none"},"cell-style":{"border-bottom":"none"},onSelectionChange:X},{default:l(()=>[a(f,{type:"selection",width:"55"}),a(f,{prop:"docName",label:"全选"})]),_:1},8,["data"])]),_:1})):z("",!0),e.value.dataResource==1?(x(),U(v,{key:1,label:"外部知识库API URL: "},{default:l(()=>[a(S,{modelValue:e.value.apiUrl,"onUpdate:modelValue":o[5]||(o[5]=u=>e.value.apiUrl=u)},null,8,["modelValue"])]),_:1})):z("",!0),e.value.dataResource==1?(x(),U(v,{key:2,label:"API Token (可选): "},{default:l(()=>[a(S,{modelValue:e.value.apiToken,"onUpdate:modelValue":o[6]||(o[6]=u=>e.value.apiToken=u)},null,8,["modelValue"])]),_:1})):z("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},ze=he(Se,[["__scopeId","data-v-702fb38e"]]);export{ze as default};
