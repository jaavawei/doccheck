var Le=Object.defineProperty,ze=Object.defineProperties;var Ae=Object.getOwnPropertyDescriptors;var ne=Object.getOwnPropertySymbols;var Ue=Object.prototype.hasOwnProperty,Je=Object.prototype.propertyIsEnumerable;var ue=(p,v,i)=>v in p?Le(p,v,{enumerable:!0,configurable:!0,writable:!0,value:i}):p[v]=i,ie=(p,v)=>{for(var i in v||(v={}))Ue.call(v,i)&&ue(p,i,v[i]);if(ne)for(var i of ne(v))Je.call(v,i)&&ue(p,i,v[i]);return p},ce=(p,v)=>ze(p,Ae(v));var C=(p,v,i)=>new Promise((U,_)=>{var $=w=>{try{L(i.next(w))}catch(k){_(k)}},T=w=>{try{L(i.throw(w))}catch(k){_(k)}},L=w=>w.done?U(w.value):Promise.resolve(w.value).then($,T);L((i=i.apply(p,v)).next())});import{d as Ee}from"./github-DJU-CCEv.js";import{q as qe,a as Be,b as He,d as Oe,c as re,e as Fe,s as Me,r as $e}from"./demand-DGlRmvAG.js";import{u as je,o as Ge,s as Ke,r as u,e as g,g as d,f as a,w as l,c as r,d as c,h as n,t as x,m as A,F as E,G as q,D as B,n as Pe,E as m,v as pe,p as Qe,j as We}from"./index-B4_lMgQc.js";import{_ as Xe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const M=p=>(Qe("data-v-0c00e524"),p=p(),We(),p),Ye={class:"main_page"},Ze={class:"table-header-container"},ea={style:{margin:"20px",height:"20px"}},aa={class:"dialog-footer"},ta={class:"dialog-content"},la={class:"content-section file-list-section"},oa={class:"section-header"},sa=M(()=>d("h3",{class:"section-title"},"文件列表",-1)),da={class:"file-count"},na={class:"file-list"},ua=["onClick"],ia={class:"file-info"},ca=M(()=>d("i",{class:"file-icon el-icon-document"},null,-1)),ra={class:"file-name"},pa={class:"file-status"},va={key:0,class:"empty-state"},ma={class:"content-section json-section"},_a={class:"section-header"},ya=M(()=>d("h3",{class:"section-title"},"提取内容 (JSON格式)",-1)),fa={class:"json-editor"},ha={key:0,class:"json-validation"},ga={key:0,class:"empty-content"},ka={class:"content-section result-section"},ba={class:"section-header"},wa=M(()=>d("h3",{class:"section-title"},"查重结果 (Markdown格式)",-1)),Sa={class:"markdown-content"},Va=["innerHTML"],Ra={key:1,class:"empty-content"},Ta={class:"dialog-footer"},Na={__name:"index",setup(p){const v=je();Ge(()=>C(this,null,function*(){U(),window.addEventListener("resize",U),k()})),Ke(()=>{window.removeEventListener("resize",U)});const i=u(0),U=()=>{const o=window.innerHeight,t=document.querySelector(".table-header-container"),f=t?t.offsetHeight:200,V=50;i.value=o-f-V-250},_=u({duplicateRepositoryName:"",dataResource:"",taskStatus:"",dataType:""}),$=()=>{_.value={duplicateRepositoryName:"",dataResource:"",taskStatus:"",dataType:""}},T=u({pageNo:1,pageSize:10}),L=u([]),w=u(0),k=()=>C(this,null,function*(){const o=yield qe(ce(ie({},T.value),{taskName:_.value.duplicateRepositoryName,taskStatus:_.value.taskStatus,dataType:_.value.dataType}));o.data.code===200&&(L.value=o.data.data.result,w.value=o.data.data.total)}),Y=()=>{k(),T.value.pageNo=1},ve=o=>{T.value.pageNo=o,k()},me=o=>{T.value.pageSize=o,k()},J=u(!1),s=u({taskName:"",duplicateRepositoryId:"",extractRuleId:[],dataType:"",duplicateType:"",duplicateRange:""}),_e=[{ruleName:"站线规则",id:0}],ye=()=>{J.value=!0,fe(),s.value={taskName:"",duplicateRepositoryId:"",extractRuleId:[],dataType:"",duplicateType:"",duplicateRange:""},H.value=[]},Z=u([]),ee=u([]),fe=()=>C(this,null,function*(){const o=yield Be();Z.value=o.data.data.repositoryDuplicate,ee.value=o.data.data.ruleDuplicate}),he=u([{name:"单文件查重",id:0},{name:"多文件查重",id:1}]),ae=()=>{J.value=!1,s.value={taskName:"",duplicateRepositoryId:"",extractRuleId:[],dataType:"",duplicateType:"",duplicateRange:""}},H=u([]),te=(o,t)=>{console.log(o,t,"0000000"),H.value=t},j=u(!1),ge=()=>C(this,null,function*(){j.value=!0;const o=new FormData;H.value.forEach(f=>{o.append("files",f.raw)}),o.append("taskDuplicateName",s.value.taskName),o.append("repositoryDuplicateId",s.value.duplicateRepositoryId),o.append("ruleDuplicateId",s.value.extractRuleId),o.append("dataType",s.value.dataType),o.append("duplicateType",s.value.duplicateType),s.value.duplicateType==0?s.value.duplicateRange="":o.append("duplicateRange",s.value.duplicateRange);const t=yield He(o);console.log(t.data),j.value=!1,t.data.code===200?(m({showClose:!0,message:"新建成功",type:"success"}),J.value=!1,k()):m({showClose:!0,message:t.data.data,type:"error"})}),ke=o=>{pe.alert("确认删除吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>C(this,null,function*(){be(o.id)})).catch(()=>{console.log("取消删除")})},be=o=>C(this,null,function*(){const t=yield Oe(o);console.log(t,"9999"),t.data.code===200?(m.success("删除成功"),k()):m.error(t.data.data)}),we=o=>{v.push({name:"detail",query:{id:o.id}})},O=u(!1),S=u([]),G=u({}),Se=o=>{G.value=o,O.value=!0,re({id:o.id}).then(t=>{t.data.code===200&&(S.value=t.data.data.subtasks,P(t.data.data.subtasks[0]))})},D=u(""),z=u(""),K=u(""),N=u(""),F=u(""),P=o=>{D.value=o.id,Fe(o.id).then(t=>{if(t.data.code===200){const f=t.data.data.extractContent;S.value=S.value.map(V=>(V.id===o.id&&(V.taskStatus=t.data.data.taskStatus),V));try{const V=JSON.parse(f);N.value=JSON.stringify(V,null,2),z.value=""}catch(V){N.value=f,z.value="JSON格式无效，编辑时请确保格式正确"}F.value=t.data.data.duplicateResult,Ve()}}).catch(t=>{console.error("获取文件详情失败:",t),m.error("获取文件详情失败")})},Ve=()=>C(this,null,function*(){F.value?K.value=Ee.parse(F.value):K.value=""}),Re=()=>{if(!D.value){m.warning("请先选择一个文件");return}try{N.value&&(JSON.parse(N.value),z.value="")}catch(o){z.value=`格式错误: ${o.message}`,m.error("JSON格式不正确，请检查");return}Me({id:D.value,extractContent:N.value}).then(o=>{o.data.code===200?m.success("保存成功"):m.error("保存失败: "+(o.data.msg||"未知错误"))}).catch(o=>{console.error("保存JSON失败:",o),m.error("保存失败，请重试")})},Te=()=>{if(!D.value){m.warning("请先选择一个文件");return}pe.confirm("确定要重新发起查重吗？这将覆盖当前结果","确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{$e(D.value).then(o=>{o.data.code===200?(m.success("已重新发起查重，请稍后查看结果"),re({id:G.value.id}).then(t=>{t.data.code===200&&(S.value=t.data.data.subtasks,P(S.value.find(f=>f.id===D.value)))})):m.error("操作失败: "+(o.data.msg||"未知错误"))}).catch(o=>{console.error("重新查重失败:",o),m.error("操作失败，请重试")})}).catch(()=>{m.info("取消操作")})},le=()=>{O.value=!1,G.value={},k()};return(o,t)=>{const f=r("el-breadcrumb-item"),V=r("el-breadcrumb"),Q=r("el-input"),h=r("el-form-item"),b=r("el-option"),I=r("el-select"),y=r("el-button"),oe=r("el-form"),R=r("el-table-column"),se=r("el-tag"),Ne=r("el-table"),Ce=r("el-pagination"),xe=r("el-card"),De=r("el-upload"),de=r("el-dialog"),W=r("el-empty"),Ie=r("el-alert");return c(),g("div",Ye,[d("div",Ze,[a(V,{separator:"/"},{default:l(()=>[a(f,{to:{path:"/"}},{default:l(()=>[n("首页")]),_:1}),a(f,null,{default:l(()=>[n("需求查重管理")]),_:1}),a(f,null,{default:l(()=>[n("需求查重任务管理")]),_:1})]),_:1})]),a(xe,{class:"search-card"},{default:l(()=>[a(oe,{inline:!0,model:_.value,class:"demo-form-inline"},{default:l(()=>[a(h,{label:"任务名称："},{default:l(()=>[a(Q,{modelValue:_.value.duplicateRepositoryName,"onUpdate:modelValue":t[0]||(t[0]=e=>_.value.duplicateRepositoryName=e),placeholder:"请输入任务名称",clearable:""},null,8,["modelValue"])]),_:1}),a(h,{label:"任务状态："},{default:l(()=>[a(I,{modelValue:_.value.taskStatus,"onUpdate:modelValue":t[1]||(t[1]=e=>_.value.taskStatus=e),placeholder:"请选择任务状态"},{default:l(()=>[a(b,{label:"已完成",value:"0"}),a(b,{label:"执行中",value:"1"}),a(b,{label:"等待中",value:"2"})]),_:1},8,["modelValue"])]),_:1}),a(h,{label:"数据类型："},{default:l(()=>[a(I,{modelValue:_.value.dataType,"onUpdate:modelValue":t[2]||(t[2]=e=>_.value.dataType=e),placeholder:"请选择数据类型"},{default:l(()=>[a(b,{label:"结构化数据",value:"0"}),a(b,{label:"非结构化数据",value:"1"})]),_:1},8,["modelValue"])]),_:1}),a(h,{class:"buttonList"},{default:l(()=>[a(y,{onClick:$},{default:l(()=>[n("重置")]),_:1}),a(y,{type:"primary",onClick:Y},{default:l(()=>[n("查询")]),_:1}),a(y,{type:"primary",onClick:Y},{default:l(()=>[n("更新状态")]),_:1})]),_:1}),a(h,{style:{"margin-left":"auto"}},{default:l(()=>[a(y,{type:"primary",onClick:ye},{default:l(()=>[n("新建查重任务")]),_:1})]),_:1})]),_:1},8,["model"]),a(Ne,{data:L.value,style:{width:"100%"},height:i.value},{default:l(()=>[a(R,{label:"序号",width:"90"},{default:l(e=>[n(x(e.$index+1),1)]),_:1}),a(R,{prop:"taskDuplicateName",label:"查重任务名称"}),a(R,{prop:"repositoryDuplicateName",label:"查重库名称"}),a(R,{prop:"ruleDuplicateName",label:"查重规则名称"}),a(R,{prop:"dataType",label:"数据类型"},{default:l(e=>[n(x(e.row.dataType==0?"结构化数据":"非结构化数据"),1)]),_:1}),a(R,{prop:"duplicateType",label:"任务类型"},{default:l(e=>[n(x(e.row.duplicateType==1?"多文件查重":"单文件查重"),1)]),_:1}),a(R,{prop:"taskStatus",label:"任务状态"},{default:l(e=>[a(se,{type:e.row.taskStatus===0||e.row.taskStatus===1?"info":e.row.taskStatus===2?"success":"danger"},{default:l(()=>[n(x(e.row.taskStatus==0?"等待中":e.row.taskStatus==1?"执行中":e.row.taskStatus==2?"已完成":"失败"),1)]),_:2},1032,["type"])]),_:1}),a(R,{prop:"updatedAt",label:"操作时间",formatter:e=>o.$filters.formatTime(e.updatedAt)},null,8,["formatter"]),a(R,{label:"操作",fixed:"right",width:"200"},{default:l(e=>[e.row.duplicateType==1?(c(),A(y,{key:0,type:"primary",onClick:X=>we(e.row)},{default:l(()=>[n("查看")]),_:2},1032,["onClick"])):(c(),A(y,{key:1,type:"primary",onClick:X=>Se(e.row)},{default:l(()=>[n("详情")]),_:2},1032,["onClick"])),a(y,{type:"danger",onClick:X=>ke(e.row)},{default:l(()=>[n("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","height"]),d("div",ea,[a(Ce,{style:{float:"right"},background:"",layout:"prev, pager, next",total:w.value,"current-page":T.value.pageNo,"page-size":T.value.pageSize,onCurrentChange:ve,onSizeChange:me},null,8,["total","current-page","page-size"])])]),_:1}),a(de,{modelValue:J.value,"onUpdate:modelValue":t[9]||(t[9]=e=>J.value=e),title:"新建查重任务",width:600,"before-close":ae},{footer:l(()=>[d("div",aa,[a(y,{onClick:ae},{default:l(()=>[n("取消")]),_:1}),a(y,{type:"primary",loading:j.value,onClick:ge},{default:l(()=>[n("确定")]),_:1},8,["loading"])])]),default:l(()=>[a(oe,{model:s.value,"label-width":"auto",style:{margin:"20px auto"}},{default:l(()=>[a(h,{label:"查重任务名称"},{default:l(()=>[a(Q,{modelValue:s.value.taskName,"onUpdate:modelValue":t[3]||(t[3]=e=>s.value.taskName=e)},null,8,["modelValue"])]),_:1}),a(h,{label:"任务类型"},{default:l(()=>[a(I,{modelValue:s.value.duplicateType,"onUpdate:modelValue":t[4]||(t[4]=e=>s.value.duplicateType=e),placeholder:"请选择任务类型"},{default:l(()=>[(c(!0),g(E,null,q(he.value,e=>(c(),A(b,{label:e.name,key:e.id,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(h,{label:"查重库选择"},{default:l(()=>[a(I,{modelValue:s.value.duplicateRepositoryId,"onUpdate:modelValue":t[5]||(t[5]=e=>s.value.duplicateRepositoryId=e),placeholder:"请选择查重库"},{default:l(()=>[(c(!0),g(E,null,q(Z.value,e=>(c(),A(b,{key:e.id,label:e.repositoryDuplicateName,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(h,{label:"查重规则"},{default:l(()=>[a(I,{modelValue:s.value.extractRuleId,"onUpdate:modelValue":t[6]||(t[6]=e=>s.value.extractRuleId=e),placeholder:"请选择查重规则"},{default:l(()=>[(c(!0),g(E,null,q(ee.value,e=>(c(),A(b,{label:e.ruleName,key:e.id,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s.value.duplicateType===1?(c(),A(h,{key:0,label:"查重范围规则"},{default:l(()=>[a(I,{modelValue:s.value.duplicateRange,"onUpdate:modelValue":t[7]||(t[7]=e=>s.value.duplicateRange=e),placeholder:"请选择查重范围规则"},{default:l(()=>[(c(),g(E,null,q(_e,e=>a(b,{label:e.ruleName,key:e.id,value:e.id},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})):B("",!0),a(h,{label:"数据类型"},{default:l(()=>[a(I,{modelValue:s.value.dataType,"onUpdate:modelValue":t[8]||(t[8]=e=>s.value.dataType=e),placeholder:"请选择数据类型"},{default:l(()=>[a(b,{label:"结构化数据",value:"0"}),a(b,{label:"非结构化数据",value:"1"})]),_:1},8,["modelValue"])]),_:1}),a(h,{label:"选择文件"},{default:l(()=>[a(De,{class:"upload-demo",action:"#","auto-upload":!1,"file-list":H.value,"on-change":te,"on-remove":te,multiple:""},{default:l(()=>[a(y,{slot:"trigger",size:"small",type:"primary"},{default:l(()=>[n(x(s.value.duplicateType==0?"选择文件":"选择附件"),1)]),_:1})]),_:1},8,["file-list"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(de,{modelValue:O.value,"onUpdate:modelValue":t[11]||(t[11]=e=>O.value=e),title:"任务详情",width:"80%","before-close":le,class:"task-detail-dialog"},{footer:l(()=>[d("div",Ta,[a(y,{onClick:le},{default:l(()=>[n("取消")]),_:1})])]),default:l(()=>[d("div",ta,[d("div",la,[d("div",oa,[sa,d("span",da,x(S.value.length)+" 个文件",1)]),d("div",na,[(c(!0),g(E,null,q(S.value,e=>(c(),g("div",{key:e.id,class:Pe(["file-item",{active:D.value===e.id,completed:e.status==="completed"}]),onClick:X=>P(e)},[d("div",ia,[ca,d("div",ra,x(e.docName),1)]),d("div",pa,[a(se,{type:e.taskStatus=="2"?"success":e.taskStatus=="3"?"danger":"info",size:"small"},{default:l(()=>[n(x(e.taskStatus=="0"?"等待中":e.taskStatus=="1"?"执行中":e.taskStatus=="2"?"已完成":"失败"),1)]),_:2},1032,["type"])])],10,ua))),128)),S.value.length===0?(c(),g("div",va,[a(W,{description:"暂无文件"})])):B("",!0)])]),d("div",ma,[d("div",_a,[ya,d("div",null,[a(y,{type:"primary",onClick:Re},{default:l(()=>[n("保存")]),_:1})])]),d("div",fa,[a(Q,{type:"textarea",rows:20,modelValue:N.value,"onUpdate:modelValue":t[10]||(t[10]=e=>N.value=e),placeholder:"请输入JSON格式内容"},null,8,["modelValue"]),z.value?(c(),g("div",ha,[a(Ie,{title:"JSON格式错误",description:z.value,type:"error","show-icon":"",size:"small"},null,8,["description"])])):B("",!0)]),!N.value&&S.value.length>0?(c(),g("div",ga,[a(W,{description:"请选择一个文件查看提取内容"})])):B("",!0)]),d("div",ka,[d("div",ba,[wa,d("div",null,[a(y,{type:"primary",onClick:Te},{default:l(()=>[n("重新发起")]),_:1})])]),d("div",Sa,[F.value?(c(),g("div",{key:0,innerHTML:K.value},null,8,Va)):S.value.length>0?(c(),g("div",Ra,[a(W,{description:"正在查重中,请稍后..."})])):B("",!0)])])])]),_:1},8,["modelValue"])])}}},za=Xe(Na,[["__scopeId","data-v-0c00e524"]]);export{za as default};
