var _=(n,C,r)=>new Promise((c,v)=>{var x=i=>{try{u(r.next(i))}catch(f){v(f)}},o=i=>{try{u(r.throw(i))}catch(f){v(f)}},u=i=>i.done?c(i.value):Promise.resolve(i.value).then(x,o);u((r=r.apply(n,C)).next())});import{i as k,r as l,X as Z,o as ee,e as p,g as e,h as te,F as H,G as j,q as se,D as ae,U as ne,V as oe,n as U,E as w,d as h,t as D,p as ie,j as le,L as re}from"./index-B4_lMgQc.js";import"./github-DJU-CCEv.js";import{_ as ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";const de=""+new URL("personal2-B5oT8D7V.png",import.meta.url).href,O=""+new URL("computed1-a07yY81F.png",import.meta.url).href;function ue(n){return k({url:"/question/createSession",method:"post",data:n})}function pe(n){return k({url:"/question/deleteSession",method:"post",data:n})}function he(n){return k({url:"/question/historyList",method:"post",data:n})}function ge(n){return k({url:"/question/historyDetail",method:"post",data:n})}const g=n=>(ie("data-v-b88352da"),n=n(),le(),n),ve={class:"left-sidebar"},fe=g(()=>e("span",{class:"icon"},"⊕",-1)),_e={class:"chat-list"},me=g(()=>e("h4",null,"历史对话",-1)),ye=["onClick"],we={class:"chat-title"},ke={class:"chat-main"},Ce=g(()=>e("div",{class:"chat-title"},D("新对话"),-1)),xe={key:0,style:{display:"flex"}},be={class:"message-content",style:{"margin-right":"15px"}},Se=g(()=>e("div",{class:"userIcon"},[e("img",{src:de,alt:"",style:{width:"20px",height:"20px"}})],-1)),Ue={key:1,style:{display:"flex"}},De=g(()=>e("img",{src:O,alt:"",style:{width:"30px",height:"30px","margin-right":"15px"}},null,-1)),Ie=["innerHTML"],Le={key:0,class:"message ai-message loading"},Pe=g(()=>e("img",{src:O,alt:"",style:{width:"30px",height:"30px","margin-right":"15px"}},null,-1)),Te=g(()=>e("div",{class:"message-content"},[e("div",{class:"loading-dots"},[e("span"),e("span"),e("span")])],-1)),qe=[Pe,Te],Me={class:"input-area"},Ne={class:"input-wrapper"},Ee=["disabled"],Fe=["disabled"],Be=g(()=>e("span",{class:"send-icon"},"➤",-1)),Ve=[Be],He={__name:"index",setup(n){const C=l(!1);l(!1),l(!1);const r=l(""),c=l(!1),v=l(null),x=l("你好，有什么可以帮你？"),o=l([]),u=l(""),i=l("");let f=l([]);const I=l(""),L=t=>_(this,null,function*(){if(o.value=[],yield q(i.value),yield M(),u.value="",yield T("1","change",t),t)G(t);else{const s={uuid:u.value,question:"新对话"};f.value.unshift(s)}I.value=t||u.value,r.value="",re(()=>{m()})}),z=()=>{L()},m=()=>{v.value&&(v.value.scrollTop=v.value.scrollHeight)},K=t=>t.replace(/\n/g,"<br>"),P=(t=!1)=>_(this,null,function*(){const s=r.value.trim();if(c.value){w({showClose:!0,message:"会话进行中，请稍后发送",type:"warning"});return}if(!s){w({showClose:!0,message:"暂无内容发送",type:"warning"});return}t||o.value.push({isUser:!0,content:s});let a={appId:"1",question:s,sessionId:i.value,uuid:u.value};c.value=!0,m(),r.value="";let d="http://192.168.100.102:32006/question/sendContentSseEmitter2",b="",S="";try{const y=yield fetch(d,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!y.ok){c.value=!1,w({showClose:!0,message:"服务错误",type:"error"});return}y.body||w({showClose:!0,message:"不支持流式",type:"error"}),c.value=!1,o.value.push({isUser:!1,content:S,pagination:!0,currentPage:1,totalPages:1,liked:!1,disliked:!1});const J=y.body.getReader(),W=new TextDecoder("utf-8");for(;;){const{done:X,value:Y}=yield J.read(),$=W.decode(Y,{stream:!0});b+=$;let N=b.split(`
`);b=N.pop()||"",N.forEach(Q=>{const E=Q.trim();if(E.startsWith("data:")){const F=E.slice(6).trim(),B=F?"{"+F:"",V=B?JSON.parse(B):{};V.data&&(S+=V.data)}});const A={isUser:!1,content:S,pagination:!0,currentPage:1,totalPages:1,liked:!1,disliked:!1};if(o.value[o.value.length-1]=A,m(),X){c.value=!1,console.log("流式输出结束了"),m();break}}}catch(y){c.value=!1,console.log(y)}}),R=t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),P())},T=(t,s,a)=>_(this,null,function*(){a||(o.value=[]),o.value.unshift({isUser:!1,content:x.value,pagination:!0,currentPage:1,totalPages:1,liked:!1,disliked:!1});try{const d=yield ue({appId:t});d.data.code===200?(u.value=a||d.data.data.uuid,i.value=d.data.data.sessionId):w({showClose:!0,message:"服务器内部创建连接异常，请稍后刷新，重新尝试",type:"warning"})}catch(d){console.log(d)}}),q=t=>_(this,null,function*(){try{(yield pe({sessionId:t,appId:"1"})).data.code}catch(s){console.log(s)}}),M=()=>_(this,null,function*(){try{const t=yield he({pageSize:1e3,pageNum:1});t.data.code===200&&(f.value=t.data.data.result)}catch(t){console.log(t)}}),G=t=>_(this,null,function*(){try{const s=yield ge({pageSize:1e3,pageNum:1,uuid:t});console.log(s,s.data.code,s.data.data.result,"ppppppppppppppppppppppppppppp"),s.data.code===200&&s.data.data.result.forEach(a=>{o.value.push({isUser:!0,content:a.question,pagination:!0,currentPage:1,totalPages:1,liked:!1,disliked:!1}),o.value.push({isUser:!1,content:a.answer,pagination:!0,currentPage:1,totalPages:1,liked:!1,disliked:!1})})}catch(s){console.log(s)}});return Z(()=>{q(i.value)}),ee(()=>{m(),T(1),M()}),(t,s)=>(h(),p("div",{class:U(["actual-page",{dark:C.value}])},[e("aside",ve,[e("button",{class:"new-chat-btn",onClick:z},[fe,te(" 开启新对话 ")]),e("div",_e,[me,(h(!0),p(H,null,j(se(f),a=>(h(),p("div",{class:"chat-group",key:a.uuid,onClick:d=>L(a.uuid)},[e("div",{class:U(["chat-item",{active:I.value===a.uuid}])},[e("span",we,D(a.question),1)],2)],8,ye))),128))])]),e("main",ke,[Ce,e("div",{class:"message-container",ref_key:"messageContainer",ref:v},[(h(!0),p(H,null,j(o.value,(a,d)=>(h(),p("div",{class:U(["message",a.isUser?"user-message":"ai-message"]),key:d},[a.isUser?(h(),p("div",xe,[e("div",be,D(a.content),1),Se])):(h(),p("div",Ue,[De,e("div",{class:"message-content",innerHTML:K(a.content)},null,8,Ie)]))],2))),128)),c.value?(h(),p("div",Le,qe)):ae("",!0)],512),e("div",Me,[e("div",Ne,[ne(e("textarea",{class:"message-input",placeholder:"请输入内容","onUpdate:modelValue":s[0]||(s[0]=a=>r.value=a),onKeydown:R,disabled:c.value},null,40,Ee),[[oe,r.value]]),e("button",{class:"send-btn",onClick:P,disabled:!r.value.trim()||c.value},Ve,8,Fe)])])])],2))}},Re=ce(He,[["__scopeId","data-v-b88352da"]]);export{Re as default};
